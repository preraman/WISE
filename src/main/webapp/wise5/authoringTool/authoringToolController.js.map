{"version":3,"sources":["authoringToolController.es6"],"names":["AuthoringToolController","$anchorScroll","$filter","$location","$mdDialog","$rootScope","$scope","$state","$timeout","ConfigService","ProjectService","SessionService","TeacherDataService","$translate","numberProject","isMenuOpen","views","id","name","label","icon","type","showToolbar","active","logoPath","getThemePath","processUI","$on","event","toState","toParams","fromState","fromParams","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","closeWarningAndRenewSession","forceLogOut","ev","alert","textContent","targetEvent","setGlobalMessage","Date","getTime","params","stateParams","isPopup","projectId","nodeId","componentId","target","targetObject","templateUrl","controller","controllerAs","$stateParams","clickOutsideToClose","escapeToClose","saveEvent","current","showStepTools","$current","view","currentViewName","getProjectId","runId","getRunId","projectTitle","getProjectTitle","turnOffJSONValidMessage","$broadcast","isJSONValid","url","mouseMoved","notifyAuthorProjectEnd","wiseBaseURL","getWISEBaseURL","window","location","message","time","globalMessage","text","eventName","category","context","componentType","data","$inject"],"mappings":"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","sourcesContent":["'use strict';\n\nclass AuthoringToolController {\n\n  constructor(\n      $anchorScroll,\n      $filter,\n      $location,\n      $mdDialog,\n      $rootScope,\n      $scope,\n      $state,\n      $timeout,\n      ConfigService,\n      ProjectService,\n      SessionService,\n      TeacherDataService) {\n    this.$anchorScroll = $anchorScroll;\n    this.$filter = $filter;\n    this.$location = $location;\n    this.$mdDialog = $mdDialog;\n    this.$rootScope = $rootScope;\n    this.$scope = $scope;\n    this.$state = $state;\n    this.$timeout = $timeout;\n    this.$translate = this.$filter('translate');\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.SessionService = SessionService;\n    this.TeacherDataService = TeacherDataService;\n\n    this.numberProject = true; // TODO: make dynamic or remove\n    this.isMenuOpen = false;\n\n    // ui-views and their corresponding names, labels, and icons\n    this.views = {\n      'root.project': {\n        id: 'projectHomeButton',\n        name: this.$translate('projectHome'),\n        label: this.$translate('projectHome'),\n        icon: 'home',\n        type: 'primary',\n        showToolbar: true,\n        active: true\n      },\n      'root.project.notebook': {\n        id: 'notebookButton',\n        name: this.$translate('notebookSettings'),\n        label: this.$translate('notebookSettings'),\n        icon: 'book',\n        type: 'primary',\n        showToolbar: true,\n        active: true\n      },\n      'root.project.asset': {\n        id: 'assetButton',\n        name: this.$translate('fileManager'),\n        label: this.$translate('fileManager'),\n        icon: 'attach_file',\n        type: 'primary',\n        showToolbar: true,\n        active: true\n      },\n      'root.project.info': {\n        id: 'infoButton',\n        name: this.$translate('PROJECT_INFO'),\n        label: this.$translate('PROJECT_INFO'),\n        icon: 'info',\n        type: 'primary',\n        showToolbar: true,\n        active: true\n      },\n      'root.main': {\n        id: 'projectListButton',\n        name: this.$translate('projectsList'),\n        label: this.$translate('projectsList'),\n        icon: 'reorder',\n        type: 'primary',\n        showToolbar: false,\n        active: true\n      },\n      'root.project.node': {\n        name: '',\n        label: '',\n        icon: '',\n        type: 'secondary',\n        showToolbar: true,\n        active: false\n      },\n      'root.project.nodeConstraints': {\n        name: '',\n        label: '',\n        icon: '',\n        type: 'secondary',\n        showToolbar: true,\n        active: false\n      },\n      'root.project.nodeEditPaths': {\n        name: '',\n        label: '',\n        icon: '',\n        type: 'secondary',\n        showToolbar: true,\n        active: false\n      },\n    };\n\n    this.logoPath = this.ProjectService.getThemePath() + '/images/encore-website-sm-logo.png';\n    this.processUI();\n\n    // listen for state change events and close the menu\n    this.$scope.$on('$stateChangeSuccess',\n        (event, toState, toParams, fromState, fromParams) => {\n      this.isMenuOpen = false;\n      this.processUI();\n    });\n\n    $scope.$on('showSessionWarning', () => {\n      let confirm = this.$mdDialog.confirm()\n          .parent(angular.element(document.body))\n          .title(this.$translate('sessionTimeout'))\n          .content(this.$translate('autoLogoutMessage'))\n          .ariaLabel(this.$translate('sessionTimeout'))\n          .ok(this.$translate('yes'))\n          .cancel(this.$translate('no'));\n      this.$mdDialog.show(confirm).then(() => {\n        this.SessionService.closeWarningAndRenewSession();\n      }, () => {\n        this.SessionService.forceLogOut();\n      });\n    });\n\n    // alert user when they're inactive for a long time\n    this.$scope.$on('showRequestLogout', (ev) => {\n      let alert = this.$mdDialog.confirm()\n          .parent(angular.element(document.body))\n          .title(this.$translate('serverUpdate'))\n          .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\n          .ariaLabel(this.$translate('serverUpdate'))\n          .targetEvent(ev)\n          .ok(this.$translate('ok'));\n\n      this.$mdDialog.show(alert).then(() => {\n        // do nothing\n      }, () => {\n        // do nothing\n      });\n    });\n\n    /*\n     * Listen for the savingProject event which means the authoring tool\n     * is in the process of saving the project and display this information\n     * globally.\n     */\n    this.$scope.$on('savingProject', () => {\n      this.setGlobalMessage(this.$translate('saving'), null);\n    });\n\n    /*\n     * Listen for the projectSaved event which means the project has just\n     * been saved to the server\n     */\n    this.$scope.$on('projectSaved', () => {\n\n      /*\n       * Wait half a second before changing the message to 'Saved' so that\n       * the 'Saving...' message stays up long enough for the author to\n       * see that the project is saving. If we don't perform this wait,\n       * it will always say 'Saved' and authors may wonder whether the\n       * project ever gets saved.\n       */\n      this.$timeout(() => {\n        this.setGlobalMessage(this.$translate('SAVED'), new Date().getTime());\n      }, 500);\n    });\n\n    /*\n     * Open the asset chooser to let the author insert an asset into the\n     * specified target\n     */\n    this.$scope.$on('openAssetChooser', (event, params) => {\n      // create the params for opening the asset chooser\n      const stateParams = {\n          isPopup: params.isPopup,\n          projectId: params.projectId,\n          nodeId: params.nodeId,\n          componentId: params.componentId,\n          target: params.target,\n          targetObject: params.targetObject\n      };\n\n      // open the dialog that will display the assets for the user to choose\n      this.$mdDialog.show({\n          templateUrl: 'wise5/authoringTool/asset/asset.html',\n          controller: 'ProjectAssetController',\n          controllerAs: 'projectAssetController',\n          $stateParams: stateParams,\n          clickOutsideToClose: true,\n          escapeToClose: true\n      });\n    });\n\n    /*\n     * Open the asset chooser to let the author insert an WISE Link into the\n     * specified target\n     */\n    this.$scope.$on('openWISELinkChooser', (event, params) => {\n      // create the params for opening the WISE Link authoring popup\n      const stateParams = {\n          projectId: params.projectId,\n          nodeId: params.nodeId,\n          componentId: params.componentId,\n          target: params.target\n      };\n\n      // open the WISE Link authoring popup\n      this.$mdDialog.show({\n          templateUrl: 'wise5/authoringTool/wiseLink/wiseLinkAuthoring.html',\n          controller: 'WISELinkAuthoringController',\n          controllerAs: 'wiseLinkAuthoringController',\n          $stateParams: stateParams,\n          clickOutsideToClose: true,\n          escapeToClose: true\n      });\n    });\n\n    this.$rootScope.$on('$stateChangeSuccess',\n        (event, toState, toParams, fromState, fromParams) => {\n      if (toState != null && toState.name == 'root.main') {\n        this.saveEvent('projectListViewed', 'Navigation');\n      }\n    });\n\n    if (this.$state.current.name == 'root.main') {\n      this.saveEvent('projectListViewed', 'Navigation');\n    }\n  }\n\n  /**\n   * Update UI items based on state, show or hide relevant menus and toolbars\n   * TODO: remove/rework this and put items in their own ui states?\n   */\n  processUI() {\n    // scroll to the top of the page\n    this.$anchorScroll('top');\n\n    // set current view and whether to show the toolbars and step tools\n    this.showStepTools = this.$state.$current.name === 'root.project' ||\n        this.$state.$current.name === 'root.project.node' ||\n        this.$state.$current.name === 'root.project.nodeConstraints' ||\n      this.$state.$current.name === 'root.project.nodeEditPaths';\n    const view = this.views[this.$state.$current.name];\n    if (view) {\n      this.currentViewName = view.name;\n      this.showToolbar = view.showToolbar;\n    } else {\n      this.currentViewName = '';\n      this.showToolbar = false;\n    }\n\n    this.projectId = this.ConfigService.getProjectId();\n    this.runId = this.ConfigService.getRunId();\n\n    if (this.projectId) {\n      this.projectTitle = this.ProjectService.getProjectTitle();\n    } else {\n      this.projectTitle = null;\n    }\n    this.turnOffJSONValidMessage();\n  }\n\n  turnOffJSONValidMessage() {\n    this.$rootScope.$broadcast('setIsJSONValid', { isJSONValid: null });\n  }\n\n  /**\n   * Navigate the user to the My Projects page in the Authoring Tool\n   */\n  goToMyProjects() {\n    this.$location.url('/author');\n  }\n\n  /**\n   * Toggle the authoring tool main menu\n   */\n  toggleMenu() {\n    this.isMenuOpen = !this.isMenuOpen;\n  }\n\n  /**\n   * Notify Session to renew when user moves the mouse\n   */\n  mouseMoved() {\n    this.SessionService.mouseMoved();\n  }\n\n  exit() {\n    this.ProjectService.notifyAuthorProjectEnd().then(() => {\n      let wiseBaseURL = this.ConfigService.getWISEBaseURL();\n      window.location = wiseBaseURL + '/teacher';\n    });\n  }\n\n  /**\n   * Set the global message at the top right\n   * @param message the message to display\n   * @param time the time to display\n   */\n  setGlobalMessage(message, time) {\n    const globalMessage = {\n      text: message,\n      time: time\n    };\n    this.$rootScope.$broadcast('setGlobalMessage', { globalMessage: globalMessage });\n  };\n\n  /**\n   * Save an Authoring Tool event\n   * @param eventName the name of the event\n   * @param category the category of the event\n   * example 'Navigation' or 'Authoring'\n   */\n  saveEvent(eventName, category) {\n    let context = 'AuthoringTool';\n    let nodeId = null;\n    let componentId = null;\n    let componentType = null;\n    let data = {};\n\n    this.TeacherDataService.saveEvent(context, nodeId, componentId,\n        componentType, category, eventName, data);\n  }\n}\n\nAuthoringToolController.$inject = [\n  '$anchorScroll',\n  '$filter',\n  '$location',\n  '$mdDialog',\n  '$rootScope',\n  '$scope',\n  '$state',\n  '$timeout',\n  'ConfigService',\n  'ProjectService',\n  'SessionService',\n  'TeacherDataService',\n  'moment'\n];\n\nexport default AuthoringToolController;\n"],"file":"authoringToolController.js"}